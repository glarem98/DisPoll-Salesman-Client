<!DOCTYPE html>

<html>
<head>
    <meta name="keywords" content="@ViewBag.KeyWord">
    <meta charset="utf-8">
    <meta name="language" content="fa">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--  <link href="Content/bootstrap.min.css" rel="stylesheet"/>-->
    <link href="Content/css/bootstrap-rtl.css" rel="stylesheet"/>
    <link href="Content/css/w3.css" rel="stylesheet"/>
    <link href="ParsaFont/Style.css" rel="stylesheet"/>
    <script src="Scripts/jquery-3.2.1.min.js"></script>
    <script src="Scripts/ckeditor/ckeditor.js"></script>
    <script src="Scripts/bootstrap-rtl.js"></script>
    <script src="Scripts/jquery.validate.min.js"></script>
    <script src="Scripts/jquery.validate.unobtrusive.min.js"></script>
    <meta name="viewport" content="width=device-width"/>
    <title>@ViewBag.Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

</head>
<body style="background-color:#E5E5E5">
<style>
    .componentColor {
        background-color: #F2F2F2 !important;
    }

    .btnColors {
        background-color: #006DA0 !important;
        color: #ECEDEF !important;
        width:auto!important;

    }

    /*.btnHoverColor:hover {
        background-color: #d3df13 !important;
        color: #212121 !important;
    }*/
    .navigationBarColor {
        background-color: #21262A !important;
        color: #7B8084;
    }

    .rightMenuColor {
        background-color: #2F3438 !important;
        color: #EFF0F4;
    }

    .rightMenuColor:hover {
        background-color: #181B20 !important;
        color: #02B2E1;
    }

    .dropbtn {
        padding: 16px;
        font-size: 16px;
        border: none;
        cursor: pointer;
    }

    .pictureInput {
        top: -1px !important;
        font-size: 12px;
        padding-left: 3px;
        padding-right: 3px;
        padding-bottom: 3px;
        color: #7B8084 !important;
        background: #F2F2F2 !important;
        background-size: 50px 30px;
    }

    input[type=text] {
        padding: 12px 20px;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    input {
        font-size: 18px;
        padding: 10px 10px 10px 5px;
        display: block;
        width: 300px;
        border: 1px solid #212121;
        background: transparent !important;
        color: #212121;
        /*border-radius: 10px;*/
    }

    label {
        color: #7B8084 !important;
        font-weight: normal !important;
        position: absolute;
        pointer-events: none;
        right: 45px;
        top: 20px;
    }

    input:focus ~ label,
    input:valid ~ label {
        top: -1px;
        font-size: 12px;
        padding-left: 3px;
        padding-right: 3px;
        padding-bottom: 3px;
        color: #7B8084 !important;
        background: #F2F2F2 !important;
        background-size: 50px 30px;
    }

    input:focus,
    input:valid {
        border-color: #006DA0 !important;
    }
</style>

<nav class="w3-sidenav w3-mobile w3-card-16 w3-animate-right " style="display:block;background-color:#2F3438" id="rightMenu">
    <div class="w3-margin ">
        <div class="w3-center " style="margin-top:8px !important">
            <img  class="w3-center w3-closenav w3-xlarge w3-circle" src="avatar/man-with-tie.png"
                  id="admin-img"
                  style="width:100px ; height:100px"/>
        </div>
        <br/>
        <a href="editProfile.html" class="rightMenuColor w3-center" id="admin-name"> &nbsp;نام کاربر</a>
        <br/>
        <a href="#" class="rightMenuColor" onclick="myFunction('shops')">
            <span class="glyphicon glyphicon-home" style="color:#7B8084"></span>&nbsp;&nbsp;فروشگاه های من
            &nbsp;<span class="glyphicon glyphicon-chevron-down" id="more" style="color:#7B8084;margin-top:2px"></span>
        </a>
        <div id="shops" class="w3-container w3-hide ">

            <a class="w3-center rightMenuColor" href="addShop.html" id="add"> <span class="glyphicon glyphicon-plus"></span>
                &nbsp;جدید&nbsp;</a>
        </div>
        <br/>
        <div class="rightMenuColor">
            <a href="showPoll.html" class="rightMenuColor"><span class="glyphicon glyphicon-signal"
                                                     style="color:#7B8084"></span>&nbsp;&nbsp; نظرسنجی های
                من </a>
        </div>
        <br/>
        <div class="rightMenuColor">
            <a href="showDiscount.html" class="rightMenuColor"><span class="glyphicon glyphicon-usd"
                                                     style="color:#7B8084"></span>&nbsp;&nbsp; تخفیف های من
            </a>
        </div>
        <br/>
        <div class="rightMenuColor">
            <a href="advertisementPage.html" class="rightMenuColor"><span class="glyphicon glyphicon-earphone"
                                                                          style="color:#7B8084"></span>&nbsp;&nbsp;
                تبلیغات </a>
        </div>
        <br/>
        <div class="rightMenuColor">
            <a href="supportPage.html" class="rightMenuColor"><span class="glyphicon glyphicon-earphone"
                                                                    style="color:#7B8084"></span>&nbsp;&nbsp; پشنیبانی
            </a>
        </div>
        <br/>
        <div class="rightMenuColor">
            <a href="#" class="rightMenuColor" id="logout"><span class="glyphicon glyphicon-off"
                                                                 style="color:#7B8084"></span>&nbsp;&nbsp; خروج از پنل
            </a>
        </div>
        <br/>
    </div>
</nav>

<header class="w3-container navigationBarColor ">
    <span class="w3-opennav w3-xlarge w3-right" id="rightMenu_open_btn">&#9776;</span>
    <div class="text-center">
        <h1><span class="w3-margin-right ;navbar-brand  w3-xxlarge w3-text "
                  style="font-family: 'Baloo Bhai', cursive; color:#7B8084!important"
                  href="HomePage.html">DisPoll</span></h1>
    </div>
</header>
<br/>

<div class="container">
    <div class=" w3-xlarge w3-center" style="color:#7B8084; margin-bottom:20px">
        فرم ایجاد تخفیف
    </div>
    <div class="col-lg-offset-2">
        <div class="w3-border w3-border-light-gray w3-card-12 w3-padding componentColor">
            <form class="form-horizontal" id="addDiscount-form">

                <div class="form-group">
                    <div class="col-md-11">
                        <select class="form-control w3-margin" required name="shops"
                                id="addDiscount-form-shopKinds-inp"
                                style="height:40px; background-color:#F2F2F2" >
                            <option class="placeholder" selected disabled hidden value="" >فروشگاه</option>
                            <option value="" disabled ></option>
                            <!--need a for to read shop types from db-->
                            <option value="" id="addDiscount-form-shopKinds-lastOp-op" disabled ></option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" name="productName" value=""
                               class="form-control w3-margin"
                               id="addDiscount-form-productName-inp" accept="application/txt"/>
                        <label> نام محصول  </label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="file" name="productBarcodeImage" value=""
                               class="form-control w3-margin pictureInput"
                               id="addDiscount-form-productBarcodeImage-file" accept="image/*"/>
                        <label class="pictureInput"> تصویر بارکد  </label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" name="productCode" value=""
                               class="form-control w3-margin"
                               id="addDiscount-form-productCode-inp" accept="application/txt"/>
                        <label> شناسه محصول  </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" name="productBrand" value=""
                               class="form-control w3-margin pictureInput"
                               id="addDiscount-form-productBrand-inp" accept="application/txt"/>
                        <label> برند محصول </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-11">
                        <input type="range" required name="percent" min="0" max="100" step="5" value="10"
                               class="form-control w3-margin"
                               id="addDiscount-form-percent-inp" accept="application/txt" onchange="show_value(this.value);"/>
                        <label> درصد تخفیف </label>
                        <div class="col w3-margin" style="color:#7B8084"> درصد انتخابی :  </div>
                        <div class="col w3-margin" id="slider_value" style="color:#7B8084;padding-right:5px !important"> 10% </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" required name="countNumber" value=""
                               class="form-control w3-margin"
                               id="addDiscount-form-countNumber-inp" accept="application/txt"/>
                        <label> تعداد </label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <!--                                  تعویض تاریخ-->
                        <input type="date" required value="" name="expireDate"
                               class="form-control w3-margin pictureInput"
                               id="addDiscount-form-expireDate-inp" accept="application/txt">
                        <label class="pictureInput"> تاریخ انقضا </label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" required name="timeout" value=""
                               class="form-control w3-margin pictureInput"
                               id="addDiscount-form-timeout-inp" accept="application/txt"/>
                        <label> مهلت </label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-11">
                        <input type="text" name="description" value=""
                               class="form-control w3-margin"
                               id="addDiscount-form-description-inp" accept="application/txt"/>
                        <label> توضیحات </label>
                    </div>
                </div>

<!--                <div class="form-group">-->
<!--                    <div class="col-md-11">-->
<!--                        <input type="file" name="productImage" value=""-->
<!--                               class="form-control w3-margin"-->
<!--                               id="addDiscount-form-productImage-inp" accept="image/*"/>-->
<!--                        <label class="pictureInput"> تصویر محصول </label>-->
<!--                    </div>-->
<!--                </div>-->

                <div class="form-group">
                    <div class="col-md-offset-5 col-md-11">
                        <input type="submit" value="ذخیره" id="addDiscount-form-submit-btn"
                               class="btn btn-default btnColors"/>
                    </div>
                </div>

            </form>
        </div>
    </div>

</div>
<br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>

<footer class="text-center w3-text-white w3-padding" style="background-color:#232935 !important">
    تمامی حقوق مادی و معنوی این سایت متعلق به DisPoll است
    <br/>
    طراحی و پیاده سازی توسط Group G
</footer>

<script>
    //Scripts for design and it's actions

    /*
    Function opening and closing subset of an tag
    parameter is id
     */
    function myFunction(id) {
        var x = document.getElementById(id);
        const y = document.getElementById("more");
        y.style.transform = "rotate(180deg)";
        if (x.className.indexOf("w3-show") == -1) {
            x.className += " w3-show";
        } else {
            x.className = x.className.replace(" w3-show", "");
            y.style.transform = "rotate(0deg)";
        }
    }

    //Out put of linearScale
    function show_value(x) {
        document.getElementById("slider_value").innerHTML = x + "%";
    }


    $(document).ready(function () {

        //Go to AdminMainPage by clicking on picture
        $("#admin-img").click(function () {
            window.location.href = "AdminMainPage.html"
        });


        //Fill in admin avatar and fullName
        if ((typeof (window.sessionStorage.avatar) !== "undefined") && (typeof (window.sessionStorage.firstName) !== "undefined")
            && (typeof (window.sessionStorage.lastName) !== "undefined")) {
            $("#admin-img").attr("src", window.sessionStorage.avatar);
            $("#admin-name").text(window.sessionStorage.firstName + " " + window.sessionStorage.lastName);
        }

        /*
         Reading from session "shops" and filled the rightMenu sub myShops
         */
        if (typeof (window.sessionStorage.shops) !== "undefined") {

            var shop_var = JSON.parse(window.sessionStorage.shops);
            for (let val of shop_var) {
                const a = document.createElement("a");
                const aTextName = document.createTextNode( val.name );
                const attrClass = document.createAttribute("class");
                attrClass.value = "rightMenuColor";
                const attrHref = document.createAttribute("href");
                attrHref.value = "showShop.html";
                const attrId = document.createAttribute("id");
                attrId.value = val.id;
                a.setAttributeNode(attrClass);
                a.setAttributeNode(attrHref);
                a.setAttributeNode(attrId);
                a.appendChild(aTextName);
                const addA = document.getElementById("add");
                const myShops = document.getElementById("shops");
                myShops.insertBefore(a, addA);

            }
        }

        //Go to AdminMainPage by clicking on picture
        $("#admin-img").click(function () {
            window.location.href = "AdminMainPage.html"
        });


        //Getting id of selected subset shop
        const my_shop = document.getElementById("shops");
        for (let val of (my_shop.childNodes)) {
            if (val.id == "add")
                return ;
            val.addEventListener("click", function () {
                window.sessionStorage.setItem("selectShop", val.id);
            })
        }

        /*
            Function to disable button if form is not valid
             */
        var $requiredInputs = $("#addDiscount-form").find("input:required");
        $requiredInputs.keyup(function () {
            var empty_test = false;
            $requiredInputs.each(function () {
                if($(this).val()==='')
                    empty_test = true;
            });

            if(empty_test === true)
                $("#addDiscount-form-submit-btn").attr("disabled", "disabled");
            else {
                $("#addDiscount-form-submit-btn").removeAttr("disabled");
            }
        });

    });


</script>

<script>
    //script for design connection to the server


    $(document).ready(function () {

        const addDiscount_form_var = document.getElementById("addDiscount-form");

        /*
         Reading from session "shops" and filled the shopKind selector sub myShops
         */
        if (typeof (window.sessionStorage.shops) !== "undefined") {

            var shop_var = JSON.parse(window.sessionStorage.shops);
            for (let val of shop_var) {
                const op = document.createElement("option");
                const opText = document.createTextNode(val.name);
                const myShops = document.getElementById("addDiscount-form-shopKinds-inp");
                const lastOp = document.getElementById("addDiscount-form-shopKinds-lastOp-op");
                op.value = val.id;
                op.appendChild(opText);
                myShops.insertBefore(op,lastOp);
            }
        }



        $("#addDiscount-form").submit(function (e) {
            e.preventDefault();

            const shop_var = addDiscount_form_var.shops.value;
            const productName_var = addDiscount_form_var.productName.value;
            const productCode_var = addDiscount_form_var.productCode.value;
            const productBrand_var = addDiscount_form_var.productBrand.value;
            const percent_var = addDiscount_form_var.percent.value;
            const count_var = addDiscount_form_var.countNumber.value;
            const expireDate_var = addDiscount_form_var.expireDate.value;
            const timeout_var = addDiscount_form_var.timeout.value;
            const description_var = addDiscount_form_var.description.value;


            var productBarcodeImage_var =$("#addDiscount-form-productBarcodeImage-file").get(0).files[0];
            // var productImage_var =$("#addDiscount-form-productImage-inp").get(0).files[0];

            var formData = new FormData();
            formData.append("shop", shop_var);
            formData.append("product_name", productName_var);
            formData.append("product_id", productCode_var);
            formData.append("product_brand", productBrand_var);
            formData.append("percent", percent_var);
            formData.append("count", count_var);
            formData.append("expire_date", expireDate_var);
            formData.append("days", timeout_var);
            formData.append("product_barcode", productBarcodeImage_var);
            // formData.append("picture", productImage_var);
            formData.append("description", description_var);


            $.get("address.txt", function (data) {
                const my_address = data + "/salesman/add-discount/";
                $.ajax({
                    type: 'POST',
                    url: my_address,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    data: formData,
                    headers: {
                        'Authorization': window.sessionStorage.token
                    },
                    crossDomain: true,
                    xhrField: {withCredentials: true},
                    success: function (resultData, status, xhr) {
                        alert(resultData.message);
                        if (resultData.result.toString() === "true") {
                            // window.location.href="AdminMainPage.html";
                        }
                    },
                    error: function () {
                        alert(" اتصال به اینترنت برقرار نیست. ");
                    }
                })

            });


        });

        /*
      Request for logout
      send authorization in header
      */
        $("#logout").click(function () {
            var logout_var = confirm(" آیا اطمینان از خروج دارید؟ ");
            if (logout_var ==true){
                $.get("address.txt", function (data) {
                    const my_address = data + "/salesman/logout/";
                    $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        contentType: 'application/json',
                        url: my_address,
                        headers:{
                            'Authorization' : window.sessionStorage.token
                        },
                        data: JSON.stringify({}),
                        success: function (resultData, status, xhr) {
                            alert(resultData.message);
                            if (resultData.result.toString() === "true") {
                                window.location.href="HomePage.html";
                            }
                        },
                        error: function () {
                            alert(" اتصال به اینترنت برقرار نیست. ");
                        }
                    })

                });

            }else{
                alert(" از این که همراه ما خواهید بود متشکریم. ");
            }
        });


    });

</script>
</body>
</html>