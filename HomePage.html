<!DOCTYPE html>

<html>
<head>
    <meta name="keywords" content="@ViewBag.KeyWord">
    <meta charset="utf-8">
    <meta name="language" content="fa">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--    <link href="Content/bootstrap.min.css" rel="stylesheet"/>-->
    <link href="Content/css/bootstrap-rtl.css" rel="stylesheet"/>
    <link href="Content/css/w3.css" rel="stylesheet"/>
    <link href="ParsaFont/Style.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src="Scripts/jquery-3.2.1.min.js"></script>
    <script src="Scripts/ckeditor/ckeditor.js"></script>
    <script src="Scripts/bootstrap-rtl.js"></script>
    <script src="Scripts/jquery.validate.min.js"></script>
    <script src="Scripts/jquery.validate.unobtrusive.min.js"></script>
    <meta name="viewport" content="width=device-width"/>
    <title>@ViewBag.Title</title>


</head>
<body style="background-color:#E5E5E5 !important">
<style>

    .fa-refresh {
        margin: 4px 0 0px 5px;
        padding: 5px;
        height: 75px;
        width: 75px;
        font-size: 18px;
        color: rgba(0, 0, 0, 0.2);
        cursor: pointer;
        -webkit-transform-origin: center center;
        transform-origin: center center;
        transition: color 0.2s ease-out, -webkit-transform 0.2s ease-out;
        transition: transform 0.2s ease-out, color 0.2s ease-out;
        transition: transform 0.2s ease-out, color 0.2s ease-out, -webkit-transform 0.2s ease-out;
    }

    .fa-refresh:hover {
        color: rgba(0, 0, 0, 0);
        -webkit-transform: rotate(180deg);
        transform: rotate(180deg);
    }

    .componentColor {
        background-color: #F2F2F2 !important;
    }

    .btnColors {
        background-color: #006DA0 !important;
        color: #ECEDEF !important;
        width: auto;
        height: 30px
    }

    /*.btnHoverColor:hover {
        background-color: #d3df13 !important;
        color: #212121 !important;
    }*/
    .navigationBarColor {
        background-color: #21262A !important;
        color: #7B8084;
    }

    .rightMenuColor {
        background-color: #2F3438 !important;
        color: #EFF0F4;
    }

    .rightMenuColor:hover {
        background-color: #181B20 !important;
        color: #02B2E1;
    }

    .col-container {
        display: table;
        width: 100%;
    }

    .col {
        display: table-cell;
        padding: 16px;
    }

    .tab {
        width: 100%;
        overflow: hidden;
        background-color: #f1f1f1;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: right;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    .signupActive {
        background-color: #ccc !important;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
    }

    input[type=text] {
        padding: 12px 20px;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    input {
        font-size: 18px;
        padding: 10px 10px 10px 5px;
        display: block;
        width: 300px;
        border: 1px solid #212121;
        background: transparent !important;
        color: #212121;
        /*border-radius: 10px;*/
    }

    label {
        color: #7B8084 !important;
        font-weight: normal !important;
        position: absolute;
        pointer-events: none;
        right: 45px;
        top: 20px;
    }

    input:focus ~ label,
    input:valid ~ label {
        top: -1px;
        font-size: 12px;
        padding-left: 3px;
        padding-right: 3px;
        padding-bottom: 3px;
        color: #7B8084 !important;
        background: #F2F2F2 !important;
        background-size: 50px 30px;
    }

    input:focus,
    input:valid {
        border-color: #006DA0 !important;
    }
</style>
<br/><br/>
<div class="container" style="background-color:none !important">
    <div class="col-container">
        <div class="col componentColor">
            <br/>
            <br/>
            <h1><span class="w3-margin-right ;navbar-brand  w3-xxlarge w3-text "
                      style="font-family: 'Baloo Bhai', cursive; color:#7B8084!important"
                      href="HomePage.html">DisPoll</span></h1>
            <br/>
            <br/>
            توضیحات سایت ما
            <br/>
            <br/>
            <br/>
            <!-- <img  style="width:300px;height:200px" src="avatar/shop.jpg"  />-->
        </div>
        <div class="col componentColor ">
            <div class="col-lg-offset-4">
                <div class="componentColor">
                    <div class="tab btn-group">
                        <button class="tablinks active" onclick="openDIV(event, 'signUp-email-auth')"
                                style="width:50% ">ثبت
                            نام
                        </button>
                        <button style="width:50%" class="tablinks" onclick="openDIV(event, 'login')">ورود</button>
                    </div>
                </div>
            </div>
            <div id="signUp-email-auth" class="tabcontent" style="display: block">
                    <div class="col-lg-offset-4">
                        <div class="w3-border w3-border-light-gray w3-card-12 w3-padding componentColor">
                            <form id="signUp-email-auth-form" class="form-horizontal">

                                <br/>
                                <div class="form-group">
                                    <div class="col-md-10">
                                        <input type="email" required name="email" value=""
                                               class="form-control w3-margin w3-transparent"
                                               id="signUp-email-auth-form-email-inp"
                                               accept="application/txt"/>
                                        <label>پست الکترونیکی</label>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-md-10">
                                        <input type="password" required name="password" value=""
                                               class="form-control w3-margin w3-transparent"
                                               id="signUp-email-auth-form-password-inp"
                                               pattern=".{5,}"
                                               accept="application/txt"/>
                                        <label>کلمه عبور</label>
                                    </div>
                                </div>

                                <div class="form-group w3-margin">
                                    <input id="signUp-email-auth-form-condition-chbox" required type="checkbox"
                                           style="float: right;margin-left:13px !important; margin-top:20px !important; margin-right:13px !important; width:15px;height:15px">
                                    <div style="margin-left:8px;" class="w3-margin">
                                        شرایط و قوانین استفاده را می پذیرم.
                                    </div>
                                </div>

                                <!--<div class="w3-margin">تصویر امنیتی زیر را وارد کنید و به خاطر داشته باشید که کد به حروف
                                    بزرگ و کوچک حساس است.
                                </div>-->
                                <div class="w3-center">

                                    <div class="form-group w3-center">
                                        <div class="col-md-10 w3-margin">
                                            <div class="captcha" id="signUp-email-auth-form-captcha-img"></div>
                                            <br/>
                                            <div style="display: table;width: 100%;margin-left:5px !important">
                                                <div style="display:table-cell">
                                                    <input class="w3-center" type="text" required placeholder="Captcha"
                                                           id="signUp-email-auth-form-captcha-inp"
                                                           accept="application/txt" style="width:300px ; height:40px"/>
                                                </div>
                                                <div style="display:table-cell">
                                                    <img src="icon/8338-200.png" class="fa-refresh"
                                                         id="signUp-email-auth-form-captchaRef-img"
                                                         style="width:30px; height:30px;margin-right:5px !important">
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <div class="col-md-offset-5 col-md-11">
                                        <input type="submit" value="ثبت نام"
                                               class="btn btn-default btnColors"
                                               id="signUp-email-auth-form-submit-btn"/>
                                    </div>
                                </div>

                            </form>
                        </div>
                    </div>
            </div>
            <div id="login" class="tabcontent">
                <div class="col-lg-offset-4">
                    <div class="w3-border w3-border-light-gray w3-card-12 w3-padding componentColor">
                        <form id="login-form" class="form-horizontal">

                            <div class="form-group">
                                <div class="col-md-10">
                                    <input type="text" required autofocus name="email" value=""
                                           class="form-control w3-margin"
                                           id="login-form-email-inp"
                                           accept="application/txt" />
                                    <label> پست الکترونیکی </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-10">
                                    <input type="password" required autofocus name="password" value=""
                                           class="form-control w3-margin"
                                           id="login-form-password-inp"
                                           accept="application/txt" />
                                    <label> کلمه عبور </label>
                                </div>
                            </div>
                            <div class="form-group w3-margin">
                                <input id="login-form-condition-chbox" type="checkbox"
                                       style="float: right;margin-left:13px !important; margin-top:20px !important; margin-right:13px !important; width:15px;height:15px">
                                <div style="margin-left:8px;" class="w3-margin">
                                    ورود به عنوان فروشنده
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-offset-5 col-md-10">
                                    <input type="submit" value="ورود " class="btn btn-default btnColors"
                                           id="login-form-submit-btn" />
                                </div>
                            </div>

                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


<br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<!--Modal container-->
<div class="modal fade" role="dialog" id="signUp-confirm-email-model">
    <div class="modal-dialog ">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" id="signUp-confirm-email-model-close">&times;</button>
                <h4 class="modal-title">کد ارسالی</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 ">
                        <img class="w3-" style="width:300px ; height:300px" src="icon/app_icon.png"/>
                        <br/>
                    </div>
                    <br/>
                    <div class="col-md-6 w3-center">
                        <br/><br/>
                        <div class="form-group col-md-offset-2">
                            <div class="col-md-10">
                                کد دریافتی:<input type="password" required autofocus name="code" value=""
                                                  class="form-control w3-margin"
                                                  id="signUp-confirm-email-model-inp"
                                                  accept="application/txt"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10 w3-padding">
                                <input data-toggle="modal" data-target="#1" type="submit" value="ثبت کد"
                                       class="btn btn-default btnColors"
                                       id="signUp-confirm-email-model-btn"/>
                            </div>
                        </div>
                        <br/><br/>
                        <div class="form-group w3-center">
                            <div class="col-md-offset-2 col-md-10 w3-padding">
                                <a style="text-decoration:none ; color:#d3df13" id="signUp-resend-code"> ارسال مجدد
                                    کد </a>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    //Scripts for design and it's actions

    /* Function to open div for signUp and login form bu tabs
       parameters are event and id of div
     */
    function openDIV(evt, divName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(divName).style.display = "block";
        evt.currentTarget.className += " active";
    }


    //Global variable for validating captcha
    var code;


    /*Function to create captcha image randomly
      return a captcha image in signUp-email-auth-form-captcha-img
     */
    function createCaptcha() {
        //clear the contents of captcha div first
        document.getElementById("signUp-email-auth-form-captcha-img").innerHTML = "";
        var charsArray =
            "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
        var lengthOtp = 6;
        var captcha = [];
        for (var i = 0; i < lengthOtp; i++) {
            //below code will not allow Repetition of Characters
            var index = Math.floor(Math.random() * charsArray.length + 1); //get the next character from the array
            if (captcha.indexOf(charsArray[index]) === -1)
                captcha.push(charsArray[index]);
            else i--;
        }
        var canv = document.createElement("canvas");
        canv.id = "captcha";
        canv.width = 100;
        canv.height = 50;
        var ctx = canv.getContext("2d");
        ctx.font = "25px Georgia";
        // ctx.color = #d3df1;
        ctx.strokeText(captcha.join(""), 0, 30);
        //storing captcha so that can validate you can save it somewhere else according to your specific requirements
        code = captcha.join("");
        document.getElementById("signUp-email-auth-form-captcha-img").appendChild(canv); // adds the canvas to the body element
    }

    $(document).ready(function () {

        //Refreshing a captcha image by clicking on captchaRef image
        $("#signUp-email-auth-form-captchaRef-img").click(function () {
            createCaptcha();
        });

        //Refreshing a form by closing a confirm email modal (maybe dosn't needed)
        $("#signUp-confirm-email-model-close").click(function () {
            $("#signUp-email-auth-form")[0].reset();
            // window.location.reload();
        });

    });

    //Testing for validation function
    // function validateCaptcha() {
    //     event.preventDefault();
    //     if (document.getElementById("signUp-email-auth-form-captcha-inp").value === code) {
    //         alert("Valid Captcha")
    //     } else {
    //         alert("Invalid Captcha. try Again");
    //         createCaptcha();
    //     }
    // }


</script>
<script>
    //Scripts for connecting to the server

    $(document).ready(function () {

        createCaptcha();


        //session ro bayad dorost konam
        // if (typeof (Storage) !== "undefined") {
        //     // Store
        //     sessionStorage.setItem("lastname", "saba");
        //     // Retrieve
        //     // alert(sessionStorage.getItem("lastname"));
        // } else {
        //     alert("Sorry, your browser does not support Web Storage...");
        // }



        $("#signUp-email-auth-form").submit(function (e) {
            e.preventDefault();

            /*If-condition to validate captcha by global var code
                      if it is invalid create another
                       return an alert as result
                     */
            if (document.getElementById("signUp-email-auth-form-captcha-inp").value === code) {
                event.preventDefault();
                // alert("Valid Captcha")

                const signUp_email_auth_form_var = document.getElementById("signUp-email-auth-form");
                const email_var = signUp_email_auth_form_var.email.value;
                const password_var = signUp_email_auth_form_var.password.value;

                if (password_var.length >= 5) {
                    const signUp_obj = {
                        email: email_var,
                        password: password_var
                    };
                    const signUp_json = JSON.stringify(signUp_obj);

                    $.get("address.txt", function (data) {
                        const my_address_signUp = data + "/salesman/signup/email-auth/";

                        $.ajax({
                            type: 'POST',
                            dataType: 'json',
                            contentType: 'application/json',
                            url: my_address_signUp,
                            data: signUp_json,
                            success: function (resultData, status, xhr) {
                                alert(resultData.message);
                                if (resultData.result.toString() === "true") {

                                    $("#signUp-confirm-email-model").modal({backdrop: "static"});


                                    $("#signUp-confirm-email-model-btn").click(function () {
                                        const code_var = document.getElementById("signUp-confirm-email-model-inp").value;

                                        const signUp_confirm_email_obj = {
                                            email: email_var,
                                            code: code_var
                                        };
                                        const signUp_confirm_email_json = JSON.stringify(signUp_confirm_email_obj);
                                        const my_address_signUp_confirm = data + "/salesman/signup/confirm-email/";
                                        $.ajax({
                                            type: 'POST',
                                            dataType: 'json',
                                            contentType: 'application/json',
                                            url: my_address_signUp_confirm,
                                            data: signUp_confirm_email_json,
                                            success: function (resultData, status, xhr) {
                                                alert(resultData.message);
                                                if (resultData.result.toString() === "true") {
                                                    window.sessionStorage.setItem("email", email_var);
                                                    alert(window.sessionStorage.email);
                                                    window.sessionStorage.setItem("password", password_var);
                                                    alert(window.sessionStorage.email);
                                                    window.location.href = "completeInfo.html";
                                                }
                                            },
                                            error: function () {
                                                alert(" اتصال به اینترنت برقرار نیست. ");
                                            }
                                        })

                                    });


                                    $("#signUp-resend-code").click(function () {
                                        const signUp_resend_code_obj = {
                                            email: email_var,
                                        };
                                        const signUp_resend_code_json = JSON.stringify(signUp_resend_code_obj);
                                        const my_address_signUp_resend = data + "/salesman/signup/resend-code/";
                                        $.ajax({
                                            type: 'POST',
                                            dataType: 'json',
                                            contentType: 'application/json',
                                            url: my_address_signUp_resend,
                                            data: signUp_resend_code_json,
                                            success: function (resultData, status, xhr) {
                                                alert(resultData.message);
                                                if (resultData.result.toString() === "true") {
                                                    alert("change");
                                                }
                                            },
                                            error: function () {
                                                alert(" اتصال به اینترنت برقرار نیست. ");
                                            }
                                        })
                                    });


                                }
                            },
                            error: function () {
                                alert(" اتصال به اینترنت برقرار نیست. ");
                                //If couldn't connecting to the server changing captcha
                                createCaptcha();
                            }
                        })

                    });
                } else
                    alert(" رمزعبور باید حداقل 5 کاراکتر باشد. ");

            } else {

                alert("تصویر امنیتی وارد شده صحیح نمی باشد." +
                    "دوباره امتحان کنید.");
                createCaptcha();
            }

        });



        $("#login-form").submit(function (e) {
            e.preventDefault();



            const login_form_var = document.getElementById("login-form");
            const email_var = login_form_var.email.value;
            const password_var = login_form_var.password.value;


            if (email_var.length >= 5 && password_var.length >= 5) {

                var login_formData = new FormData();
                login_formData.append("email", email_var);
                login_formData.append("password", password_var);

                $.get("address.txt", function (data) {
                    const my_address = data + "/salesman/login/";

                    $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        contentType: false,
                        processData: false,
                        url: my_address,
                        data: login_formData,
                        crossDomain: true,
                        xhrField: {withCredentials: true},
                        success: function(resultData, status, xhr){
                            alert(resultData.message);
                            if (resultData.result.toString() === "true") {
                                window.sessionStorage.setItem("token", "Token " + resultData.token);
                                window.sessionStorage.setItem("salesman", resultData.salesman.id);
                                window.sessionStorage.setItem("avatar", data + resultData.salesman.avatar);
                                window.sessionStorage.setItem("firstName", resultData.salesman.first_name);
                                window.sessionStorage.setItem("lastName", resultData.salesman.last_name);
                                //چک شود
                                window.sessionStorage.setItem("shops", JSON.stringify(resultData.salesman.shops));

                                //condition to specify login az salesman or patron
                                if(document.getElementById("login-form-condition-chbox").checked){
                                    window.location.href="AdminMainPage.html";
                                }else{
                                    window.location.href="PatronMainPage.html";
                                }

                            }
                        },
                        error: function () {
                            alert(" اتصال به اینترنت برقرار نیست. ");
                        }
                    })

                });
            } else
                alert("طول نام کاربری و رمزعبور باید حداقل 5 کاراکتر باشد.");
        });


    });

</script>

</body>
</html>