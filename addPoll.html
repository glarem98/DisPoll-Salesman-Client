<!DOCTYPE html>

<html>
<head>
    <meta name="keywords" content="@ViewBag.KeyWord">
    <meta charset="utf-8">
    <meta name="language" content="fa">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="Content/css/bootstrap-rtl.css" rel="stylesheet" />
    <link href="Content/css/w3.css" rel="stylesheet" />
    <link href="ParsaFont/Style.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.2.1.min.js"></script>
    <script src="Scripts/ckeditor/ckeditor.js"></script>
    <script src="Scripts/bootstrap-rtl.js"></script>
    <script src="Scripts/jquery.validate.min.js"></script>
    <script src="Scripts/jquery.validate.unobtrusive.min.js"></script>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

</head>
<body style="background-color:#E5E5E5">
    <style>
        .col-container {
            display: table;
            width: 100%;
        }

        .col {
            display: table-cell;
            padding: 16px;
        }

        .componentColor {
            background-color: #F2F2F2 !important;
        }

        .btnColors {
            background-color: #006DA0 !important;
            color: #ECEDEF !important;
            width: auto;
            height: 30px
        }

        /*.btnHoverColor:hover {
            background-color: #d3df13 !important;
            color: #212121 !important;
        }*/
        .navigationBarColor {
            background-color: #21262A !important;
            color: #7B8084;
        }

        .rightMenuColor {
            background-color: #2F3438 !important;
            color: #EFF0F4;
        }

            .rightMenuColor:hover {
                background-color: #181B20 !important;
                color: #02B2E1;
            }

        .dropbtn {
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        input[type=text] {
            padding: 12px 20px;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        input {
            font-size: 18px;
            padding: 10px 10px 10px 5px;
            display: block;
            width: 300px;
            border: 1px solid #212121;
            background: transparent !important;
            color: #212121;
            /*border-radius: 10px;*/
        }

        label {
            color: #7B8084 !important;
            font-weight: normal !important;
            position: absolute;
            pointer-events: none;
            right: 45px;
            top: 20px;
        }

        input:focus ~ label,
        input:valid ~ label {
            top: -1px;
            font-size: 12px;
            padding-left: 3px;
            padding-right: 3px;
            padding-bottom: 3px;
            color: #7B8084 !important;
            background: #F2F2F2 !important;
            background-size: 50px 30px;
        }

        input:focus,
        input:valid {
            border-color: #006DA0 !important;
        }
    </style>

    <nav class="w3-sidenav w3-mobile w3-card-16 w3-animate-right " style="display:block;background-color:#2F3438" id="rightMenu">
        <div class="w3-margin ">
            <div class="w3-center " style="margin-top:8px !important">
                <img  class="w3-center w3-closenav w3-xlarge w3-circle" src="avatar/man-with-tie.png"
                      id="admin-img"
                      style="width:100px ; height:100px"/>
            </div>
            <br/>
            <a href="editProfile.html" class="rightMenuColor w3-center" id="admin-name"> &nbsp;نام کاربر</a>
            <br/>
            <a href="#" class="rightMenuColor" onclick="myFunction('shops')">
                <span class="glyphicon glyphicon-home" style="color:#7B8084"></span>&nbsp;&nbsp;فروشگاه های من
                &nbsp;<span class="glyphicon glyphicon-chevron-down" id="more" style="color:#7B8084;margin-top:2px"></span>
            </a>
            <div id="shops" class="w3-container w3-hide ">

                <a class="w3-center rightMenuColor" href="addShop.html" id="add"> <span class="glyphicon glyphicon-plus"></span>
                    &nbsp;جدید&nbsp;</a>
            </div>
            <br/>
            <div class="rightMenuColor">
                <a href="showPoll.html" class="rightMenuColor"><span class="glyphicon glyphicon-signal"
                                                                     style="color:#7B8084"></span>&nbsp;&nbsp; نظرسنجی های
                    من </a>
            </div>
            <br/>
            <div class="rightMenuColor">
                <a href="showDiscount.html" class="rightMenuColor"><span class="glyphicon glyphicon-usd"
                                                                         style="color:#7B8084"></span>&nbsp;&nbsp; تخفیف های من
                </a>
            </div>
            <br/>
            <div class="rightMenuColor">
                <a href="advertisementPage.html" class="rightMenuColor"><span class="glyphicon glyphicon-earphone"
                                                                              style="color:#7B8084"></span>&nbsp;&nbsp;
                    تبلیغات </a>
            </div>
            <br/>
            <div class="rightMenuColor">
                <a href="supportPage.html" class="rightMenuColor"><span class="glyphicon glyphicon-earphone"
                                                                        style="color:#7B8084"></span>&nbsp;&nbsp; پشنیبانی
                </a>
            </div>
            <br/>
            <div class="rightMenuColor">
                <a href="#" class="rightMenuColor" id="logout"><span class="glyphicon glyphicon-off"
                                                                     style="color:#7B8084"></span>&nbsp;&nbsp; خروج از پنل
                </a>
            </div>
            <br/>
        </div>
    </nav>

    <header class="w3-container navigationBarColor ">
        <span class="w3-opennav w3-xlarge w3-right" id="rightMenu_open_btn">&#9776;</span>
        <div class="text-center">
            <h1> <span class="w3-margin-right ;navbar-brand  w3-xxlarge w3-text " style="font-family: 'Baloo Bhai', cursive; color:#7B8084!important" href="HomePage.html">DisPoll</span></h1>
        </div>
    </header>
    <br />
    <div class="container">
        <div class=" w3-xlarge w3-center" style="color:#7B8084; margin-bottom:20px">
            فرم ایجاد نظرسنجی
        </div>
        <div class="col-lg-offset-2">
            <div class="w3-border w3-border-light-gray w3-card-12 w3-padding componentColor">
                <form class="form-horizontal" id="poll-form" novalidate>

                    <div class="form-group">
                            <div class="col-md-11">
                                <select class="form-control w3-margin" required name="shops"
                                        id="poll-form-shopKinds-inp"
                                        style="height:40px; background-color:#F2F2F2">
                                    <option class="placeholder" selected disabled hidden value="" >فروشگاه</option>
                                    <option value="" disabled ></option>
                                    <!--need a for to read shop types from db-->
                                    <option value="" id="poll-form-shopKinds-lastOp-op" disabled ></option>
                                </select>
                            </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-11">

                            <input type="range" required name="importance" min="0" max="100" step="10" value="10"
                                   class="form-control w3-margin"
                                   id="poll-form-importance-inp" accept="application/txt" onchange="show_value(this.value);" />
                            <label> درصد اهمیت    </label>
                            <div class="col" style="color:#7B8084"> درصد انتخابی :  </div>
                            <div class="col" id="slider_value" style="color:#7B8084;padding-right:5px !important"> 10% </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-11">
                            <!--                                  تعویض تاریخ-->
                            <input type="date" required autofocus value="" name="expireDate"
                                   class="form-control w3-margin pictureInput"
                                   id="poll-form-timeout-inp" accept="application/txt">
                            <label class="pictureInput"> مهلت </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-11">
                            <input type="text" required autofocus name="question" value="" class=" form-control  w3-margin" id="Poll-form-question-inp"
                                   accept="application/txt" />
                            <label> سوال </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-11">

                            <select id="poll-form-kind-inp" class="form-control w3-margin" name="kind" style="height:40px;background-color:#F2F2F2" required>
                                <option class="placeholder" selected disabled hidden value="" > نوع نظرسنجی </option>
                                <option value="" disabled ></option>
                                <option value="MultipleChoicePoll"> چند گزینه ای</option>
                                <option value="CheckBoxPoll"> تک گزینه ای </option>
                                <option value="ParagraphPoll">پاسخ چند خطی </option>
                                <option value="ShortAnswerPoll">پاسخ کوتاه </option>
                                <option value="LinearScalePoll">نوار شناور</option>

                            </select>
                        </div>
                    </div>
                    <!-- this one need a style="display:none;"-->
                    <div class="form-group" id="choices" style="display: none">

                        <div class="w3-center">
                            گزینه ها
                        </div>
                        <div style="border : solid 1px gray" class="w3-margin"></div>
                        <!--this htlm should be copy in next div when the + bottom is clicked-->
                        <div class="col-md-11" id="cloneChoice">
                            <span style="margin-top:20px ; direction:rtl">
                                <input type="text" required autofocus name="choice" value="" class="form-control w3-center w3-margin" id="poll-form-choice-inp"
                                       accept="application/txt" />
                                <label> گزینه </label>
                            </span>
                        </div>
                        <div class="col-md-2" id="addChoice" onclick="addChoice()">
                            <button style="margin:20px" class="btn btn-default btnColors" ><i class="fa fa-plus"><strong style="text-align:center;font-style:normal!important">+</strong></i></button>
                        </div>
                    </div>
                    <!-- for next div we should add  style="display:none;"  -->
                    <div id="LinearScale" style="display: none">

                        <div class="w3-center">
                            محدودیت ها
                        </div>
                        <div style="border : solid 1px gray" class="w3-margin"></div>
                        <div class="col-container"></div>
                        <div class="form-group col">
                            <div class="col-md-11">
                                <input class="form-control question-format-max w3-margin" name="start" type="number" placeholder="شروع بازه" value="">
                            </div>
                        </div>
                        <div class="form-group col">
                            <div class="col-md-11">
                                <input class="form-control question-format-max w3-margin" name="step" type="number" placeholder=" اندازه گام" value="">
                            </div>
                        </div>
                        <div class="form-group col">
                            <div class="col-md-11">
                                <input class="form-control question-format-max w3-margin" name="choicesCount" type="number" placeholder=" تعداد گام ها " value="">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-5 col-md-11">
                            <input type="submit" value="ذخیره" class="btn btn-default btnColors" id="poll-form-submit-btn" />
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <br /><br /><br />
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />

    <footer class="text-center w3-text-white w3-padding" style="background-color:#232935 !important">
        تمامی حقوق مادی و معنوی این سایت متعلق به DisPoll است
        <br />
        طراحی و پیاده سازی توسط Group G
    </footer>

    <script>
        //Scripts for design and it's actions

        /*
        Function opening and closing subset of an tag
        parameter is id
         */
        function myFunction(id) {
            var x = document.getElementById(id);
            const y = document.getElementById("more");
            y.style.transform = "rotate(180deg)";
            if (x.className.indexOf("w3-show") == -1) {
                x.className += " w3-show";
            } else {
                x.className = x.className.replace(" w3-show", "");
                y.style.transform = "rotate(0deg)";
            }
        }


        $(document).ready(function () {

            //Go to AdminMainPage by clicking on picture
            $("#admin-img").click(function () {
                window.location.href = "AdminMainPage.html"
            });


            //Fill in admin avatar and fullName
            if ((typeof (window.sessionStorage.avatar) !== "undefined") && (typeof (window.sessionStorage.firstName) !== "undefined")
                && (typeof (window.sessionStorage.lastName) !== "undefined")) {
                $("#admin-img").attr("src", window.sessionStorage.avatar);
                $("#admin-name").text(window.sessionStorage.firstName + " " + window.sessionStorage.lastName);
            }

            /*
             Reading from session "shops" and filled the rightMenu sub myShops
             */
            if (typeof (window.sessionStorage.shops) !== "undefined") {

                var shop_var = JSON.parse(window.sessionStorage.shops);
                for (let val of shop_var) {
                    const a = document.createElement("a");
                    const aTextName = document.createTextNode( val.name );
                    const attrClass = document.createAttribute("class");
                    attrClass.value = "rightMenuColor";
                    const attrHref = document.createAttribute("href");
                    attrHref.value = "showShop.html";
                    const attrId = document.createAttribute("id");
                    attrId.value = val.id;
                    a.setAttributeNode(attrClass);
                    a.setAttributeNode(attrHref);
                    a.setAttributeNode(attrId);
                    a.appendChild(aTextName);
                    const addA = document.getElementById("add");
                    const myShops = document.getElementById("shops");
                    myShops.insertBefore(a, addA);

                }
            }

            //Go to AdminMainPage by clicking on picture
            $("#admin-img").click(function () {
                window.location.href = "AdminMainPage.html"
            });


            //Getting id of selected subset shop
            const my_shop = document.getElementById("shops");
            for (let val of (my_shop.childNodes)) {
                if (val.id == "add")
                    return ;
                val.addEventListener("click", function () {
                    window.sessionStorage.setItem("selectShop", val.id);
                })
            }


        });


    </script>


    <script>


        function show_value(x) {
            document.getElementById("slider_value").innerHTML = x + "%";
        }


        $(document).ready(function () {
            const poll_form_var = document.getElementById("poll-form");
            $("#poll-form-kind-inp").change(function () {
                if (poll_form_var.kind.value == "LinearScalePoll") {
                    document.getElementById("LinearScale").style.display = "block";
                    document.getElementById("choices").style.display = "none";
                } else if (poll_form_var.kind.value == "MultipleChoicePoll") {
                    document.getElementById("LinearScale").style.display = "none";
                    document.getElementById("choices").style.display = "block";
                } else if (poll_form_var.kind.value == "CheckBoxPoll") {
                    document.getElementById("LinearScale").style.display = "none";
                    document.getElementById("choices").style.display = "block";
                } else {
                    document.getElementById("LinearScale").style.display = "none";
                    document.getElementById("choices").style.display = "none";
                }
            });

        });


        /*
        Function to insert one by one choice if they are not empty
         */
        function addChoice() {

            var $poll_form_choices = $("input[name ='choice']");
            var empty_test = false;
            $poll_form_choices.each(function () {
                if ($(this).val() === '')
                    empty_test = true;
            });
            if (empty_test === false) {
                $("#cloneChoice").clone().prependTo("#addChoice");
                var $poll_form_choices1 = $("input[name ='choice']");
                // $poll_form_choices1[($poll_form_choices1.length)-1].removeAttribute("value");
                $poll_form_choices1[($poll_form_choices1.length) - 1].value = "";
            }

        }


        $(document).ready(function () {

            const poll_form_var = document.getElementById("poll-form");

            /*
            Reading from session "shops" and filled the shopKind selector sub myShops
            */
            if (typeof (window.sessionStorage.shops) !== "undefined") {

                var shop_var = JSON.parse(window.sessionStorage.shops);
                for (let val of shop_var) {
                    const op = document.createElement("option");
                    const opText = document.createTextNode(val.name);
                    const myShops = document.getElementById("poll-form-shopKinds-inp");
                    const lastOp = document.getElementById("poll-form-shopKinds-lastOp-op");
                    op.value = val.id;
                    op.appendChild(opText);
                    myShops.insertBefore(op, lastOp);
                }
            }


            $("#poll-form").submit(function (e) {
                e.preventDefault();

                const shop_var = poll_form_var.shops.value;
                const type_var = poll_form_var.kind.value;
                const importance_var = poll_form_var.importance.value;
                const expireDate_var = poll_form_var.expireDate.value;
                const text_var = poll_form_var.question.value;
                const start_var = poll_form_var.start.value;
                const step_var = poll_form_var.step.value;
                const choicesCount_var = poll_form_var.choicesCount.value;
                var answerTexts_var = "";
                var $poll_form_choices2 = $("input[name ='choice']");
                for (var i=0 ; i<($poll_form_choices2.length)-1 ; i++){
                    answerTexts_var = answerTexts_var.concat($poll_form_choices2[i].value);
                    answerTexts_var = answerTexts_var.concat(",");
                }
                answerTexts_var = answerTexts_var.concat($poll_form_choices2[i].value);
                //alert


                var poll_formData = new FormData();
                poll_formData.append("shop", shop_var);
                poll_formData.append("type_poll", type_var);
                poll_formData.append("importance", importance_var/10);
                poll_formData.append("expire_date", expireDate_var);
                poll_formData.append("text", text_var);

                if (poll_form_var.kind.value == "LinearScalePoll") {
                    poll_formData.append("start", start_var);
                    poll_formData.append("step", step_var);
                    poll_formData.append("choices_count", choicesCount_var);
                } else if (poll_form_var.kind.value == "MultipleChoicePoll") {
                    poll_formData.append("answer_texts", answerTexts_var);
                } else if (poll_form_var.kind.value == "CheckBoxPoll") {
                    poll_formData.append("answer_texts", answerTexts_var);
                }

                $.get("address.txt", function (data) {

                    const my_address = data + "/salesman/add-poll/";

                    $.ajax({
                        type: 'POST',
                        url: my_address,
                        dataType: 'json',
                        contentType: false,
                        processData: false,
                        crossDomain: true,
                        headers: {
                            'Authorization': window.sessionStorage.token
                        },
                        data: poll_formData,
                        success: function (resultData, status, xhr) {
                            alert(resultData.message);
                            if (resultData.result.toString() === "true") {
                                // window.location.href="advertisementPage.html";
                                // window.location.reload();
                            }
                        },
                        error: function () {
                            alert(" اتصال به اینترنت برقرار نیست. ");
                        }
                    })

                });

            });

            /*
           Request for logout
           send authorization in header
           */
            $("#logout").click(function () {
                var logout_var = confirm(" آیا اطمینان از خروج دارید؟ ");
                if (logout_var == true) {
                    $.get("address.txt", function (data) {
                        const my_address = data + "/salesman/logout/";
                        $.ajax({
                            type: 'POST',
                            dataType: 'json',
                            contentType: 'application/json',
                            url: my_address,
                            headers: {
                                'Authorization': window.sessionStorage.token
                            },
                            data: JSON.stringify({}),
                            success: function (resultData, status, xhr) {
                                alert(resultData.message);
                                if (resultData.result.toString() === "true") {
                                    window.location.href = "HomePage.html";
                                }
                            },
                            error: function () {
                                alert(" اتصال به اینترنت برقرار نیست. ");
                            }
                        })

                    });

                } else {
                    alert(" از این که همراه ما خواهید بود متشکریم. ");
                }
            });


        });


    </script>


</body>
</html>